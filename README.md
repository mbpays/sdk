# MBPay SDK

MBPay å•†æˆ· API çš„å¤šè¯­è¨€ SDK é›†åˆï¼Œæä¾›å•†æˆ·ä½™é¢æŸ¥è¯¢ã€ä»˜æ¬¾å’Œæ”¯ä»˜é“¾æ¥ç”ŸæˆåŠŸèƒ½ã€‚

## ä»“åº“åœ°å€

```
git@github.com:mbpay/sdk.git
```

## æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€

| è¯­è¨€ | ç‰ˆæœ¬è¦æ±‚ | æ–‡æ¡£ | ç¤ºä¾‹ |
|------|----------|------|------|
| [Go](#go-sdk) | Go >= 1.16 | [README](./go/README.md) | [example.go](./go/mbpay/example.go) |
| [Python](#python-sdk) | Python >= 3.7 | [README](./python/README.md) | [example.py](./python/mbpay/example.py) |
| [PHP](#php-sdk) | PHP >= 7.4 | [README](./php/README.md) | [example.php](./php/example.php) |
| [Node.js](#nodejs-sdk) | Node.js >= 12.0.0 | [README](./nodejs/README.md) | [example.ts](./nodejs/example.ts) |
| [Java](#java-sdk) | Java >= 1.8 | [README](./java/README.md) | [Example.java](./java/src/main/java/com/mbpay/Example.java) |

## åŠŸèƒ½ç‰¹æ€§

æ‰€æœ‰ SDK éƒ½æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- âœ… **å•†æˆ·ä½™é¢æŸ¥è¯¢** - æŸ¥è¯¢å•†æˆ·å¯ç”¨ä½™é¢å’Œå†»ç»“ä½™é¢
- âœ… **å•†æˆ·ä»˜æ¬¾** - å•†æˆ·å‘ç”¨æˆ·åœ°å€ä»˜æ¬¾
- âœ… **æ”¯ä»˜é“¾æ¥ç”Ÿæˆ** - ç”Ÿæˆæ”¯ä»˜äºŒç»´ç é“¾æ¥
- âœ… **è®¢å•ä¿¡æ¯æŸ¥è¯¢** - æŸ¥è¯¢è®¢å•è¯¦ç»†ä¿¡æ¯
- âœ… **æ”¯ä»˜è®¢å•ä¿¡æ¯æŸ¥è¯¢** - æŸ¥è¯¢æ”¯ä»˜è®¢å•è¯¦ç»†ä¿¡æ¯
- âœ… **è‡ªåŠ¨ç­¾å** - è‡ªåŠ¨ç”Ÿæˆå’ŒéªŒè¯ç­¾å
- âœ… **é”™è¯¯å¤„ç†** - å®Œæ•´çš„é”™è¯¯ç å’Œå¼‚å¸¸å¤„ç†
- âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œå‚æ•°éªŒè¯

## è¯¦ç»†æ–‡æ¡£

- ğŸ“– [API æ¥å£æ–‡æ¡£](./APIæ¥å£æ–‡æ¡£.md) - è¯¦ç»†çš„ API æ¥å£è¯´æ˜ï¼ŒåŒ…æ‹¬æ¥å£åœ°å€ã€è¯·æ±‚å‚æ•°ã€è¿”å›ç»“æœã€é”™è¯¯ç ç­‰
- ğŸ“– [è®¢å•æ”¯ä»˜æˆåŠŸå›è°ƒæ–‡æ¡£](./è®¢å•æ”¯ä»˜æˆåŠŸå›è°ƒæ–‡æ¡£.md) - æ”¯ä»˜é“¾æ¥ç¼–ç ç”Ÿæˆçš„è¯¦ç»†è¯´æ˜ï¼ŒåŒ…æ‹¬ç¼–ç è§„åˆ™ã€ç­¾åç®—æ³•ã€ç¤ºä¾‹ä»£ç ç­‰

## å¿«é€Ÿå¼€å§‹

### Go SDK

```bash
go get github.com/mbpay/sdk/go/mbpay
```

[æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ â†’](./go/README.md)

### Python SDK

```bash
# ä» GitHub å®‰è£…
pip install git+https://github.com/mbpay/sdk.git#subdirectory=python

# æˆ–æœ¬åœ°å®‰è£…
cd python
pip install -e .
```

[æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ â†’](./python/README.md)

### PHP SDK

```bash
# ä» GitHub å®‰è£…
composer require mbpay/mbpay-sdk:dev-main

# æˆ–æœ¬åœ°å®‰è£…
cd php
composer install
```

[æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ â†’](./php/README.md)

### Node.js SDK

```bash
# ä» GitHub å®‰è£…
npm install github:mbpay/sdk#nodejs

# æˆ–æœ¬åœ°å®‰è£…
cd nodejs
npm install
```

[æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ â†’](./nodejs/README.md)

### Java SDK

```bash
# æœ¬åœ°å®‰è£…
cd java
mvn clean install
```

[æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ â†’](./java/README.md)

## API æ¥å£è¯´æ˜

### 1. è·å–å•†æˆ·ä½™é¢

**æ¥å£ï¼š** `POST /merchant/balance`

**å¿…ä¼ å‚æ•°ï¼š**
- `app_id` - å•†æˆ·çš„ App ID
- `timestamp` - æ—¶é—´æˆ³ï¼ˆUnix æ—¶é—´æˆ³ï¼Œç§’çº§ï¼‰
- `sign` - ç­¾åå€¼ï¼ˆæ ¹æ®ç­¾åè§„åˆ™ç”Ÿæˆï¼‰

**è¿”å›ï¼š**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "balance": 100,
    "frozen": 0
  }
}
```

### 2. å•†æˆ·å‘ç”¨æˆ·ä»˜æ¬¾

**æ¥å£ï¼š** `POST /merchant/pay`

**å¿…ä¼ å‚æ•°ï¼š**
- `address` - æ”¶æ¬¾åœ°å€
- `order_no` - å•†æˆ·è®¢å•å·ï¼ˆå¿…é¡»å”¯ä¸€ï¼‰
- `amount` - ä»˜æ¬¾é‡‘é¢ï¼ˆMBï¼Œæœ€å°å•ä½ï¼š100 = 1MBï¼‰
- `remark` - å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
- `app_id` - å•†æˆ·çš„ App ID
- `timestamp` - æ—¶é—´æˆ³
- `sign` - ç­¾åå€¼

**è¿”å›ï¼š**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "platform_order_no": "202501011200001234567890",
    "actual_amount": 100,
    "fee": 1,
    "balance": 99
  }
}
```

### 3. ç”Ÿæˆæ”¯ä»˜é“¾æ¥

**åŠŸèƒ½ï¼š** ç”Ÿæˆæ”¯ä»˜äºŒç»´ç é“¾æ¥ï¼Œç”¨äºç”¨æˆ·æ‰«ç æ”¯ä»˜

**è¿”å›æ ¼å¼ï¼š** `mbpay://payorder?data={base64_encoded_json}`

### 4. æŸ¥è¯¢è®¢å•ä¿¡æ¯

**æ¥å£ï¼š** `POST /merchant/orderinfo`

**å¿…ä¼ å‚æ•°ï¼š**
- `order_no` - å•†æˆ·è®¢å•å·
- `merchant_id` - å•†æˆ·ID
- `app_id` - å•†æˆ·çš„ App ID
- `timestamp` - æ—¶é—´æˆ³
- `sign` - ç­¾åå€¼

**è¿”å›ï¼š**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "order_no": "ORD202501011200001234567890",
    "platform_order_no": "202501011200001234567890",
    "amount": 1000,
    "platform_fee": 10,
    "status": 1,
    "status_text": "å·²æ”¯ä»˜",
    "expires_at": "2025-01-01 12:15:00",
    "created_at": "2025-01-01 12:00:00",
    "paid_at": "2025-01-01 12:10:00"
  }
}
```

### 5. æŸ¥è¯¢æ”¯ä»˜è®¢å•ä¿¡æ¯

**æ¥å£ï¼š** `POST /merchant/payorderinfo`

**å¿…ä¼ å‚æ•°ï¼š**
- `order_no` - å•†æˆ·è®¢å•å·
- `app_id` - å•†æˆ·çš„ App ID
- `timestamp` - æ—¶é—´æˆ³
- `sign` - ç­¾åå€¼

**è¿”å›ï¼š**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "order_no": "PAY202501011200001234567890",
    "platform_order_no": "202501011200001234567890",
    "amount": 100,
    "fee": 1,
    "actual_amount": 100,
    "status": 1,
    "status_text": "å·²æ”¯ä»˜",
    "remark": "å•†æˆ·ä»˜æ¬¾",
    "create_at": "2025-01-01 12:00:00",
    "update_at": "2025-01-01 12:10:00",
    "pay_address": "Txxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
  }
}
```

## ç­¾åè§„åˆ™

æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç­¾åéªŒè¯ï¼ŒSDK ä¼šè‡ªåŠ¨å¤„ç†ç­¾åç”Ÿæˆã€‚ç­¾åè§„åˆ™å¦‚ä¸‹ï¼š

1. **æ’é™¤ `sign` å­—æ®µ**ï¼Œå¯¹æ‰€æœ‰å…¶ä»–å‚æ•°æŒ‰ **ASCII å‡åº**æ’åº
2. å°†å‚æ•°æ‹¼æ¥ä¸ºï¼š`k1=v1&k2=v2&...&key=app_secret`
3. å¯¹æ‹¼æ¥åçš„å­—ç¬¦ä¸²è¿›è¡Œ **SHA256** å“ˆå¸Œè®¡ç®—
4. å°†å“ˆå¸Œç»“æœè½¬æ¢ä¸º **å°å†™ hex** å­—ç¬¦ä¸²ï¼Œä½œä¸º `sign` å€¼

**ç¤ºä¾‹ï¼š**
```
å‚æ•°ï¼šapp_id=your_api_key_here, timestamp=1234567890
ç­¾åå­—ç¬¦ä¸²ï¼šapp_id=your_api_key_here&timestamp=1234567890&key=your_api_key_here
ç­¾åç»“æœï¼šSHA256(ç­¾åå­—ç¬¦ä¸²) çš„å°å†™ hex
```

## è¯·æ±‚å‚æ•°ç¼–ç æ–¹å¼

æ‰€æœ‰æ¥å£ä½¿ç”¨ `application/x-www-form-urlencoded` æ ¼å¼ï¼ˆFormDataï¼‰ï¼Œæ‰€æœ‰å‚æ•°ä»¥è¡¨å•å½¢å¼æäº¤ã€‚

## è¿”å›ç»“æ„

æ‰€æœ‰æ¥å£ç»Ÿä¸€è¿”å› JSON æ ¼å¼ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```json
{
  "code": 0,           // 0 è¡¨ç¤ºæˆåŠŸï¼Œé0ä¸ºé”™è¯¯ç 
  "message": "success", // é”™è¯¯æè¿°ä¿¡æ¯
  "data": {}           // è¿”å›æ•°æ®ï¼ˆæˆåŠŸæ—¶åŒ…å«ï¼Œå¤±è´¥æ—¶å¯èƒ½ä¸ºç©ºï¼‰
}
```

## é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 0 | æˆåŠŸ |
| 12000 | app_id ä¸ºç©º |
| 12001 | sign ä¸ºç©º |
| 12002 | timestamp ä¸ºç©º |
| 12003 | å•†æˆ·ä¸å­˜åœ¨ |
| 12005 | ç­¾åé”™è¯¯ |
| 12006 | å‚æ•°é”™è¯¯ |
| 12007 | å•†æˆ·ä¸å­˜åœ¨ |
| 12008 | å•†æˆ·çŠ¶æ€é”™è¯¯ |
| 12009 | å•†æˆ·ä¸å­˜åœ¨ |
| 12010 | ä½™é¢ä¸è¶³ |
| 12011 | è®¢å•å·å·²å­˜åœ¨ / æ”¶æ¬¾åœ°å€ä¸å­˜åœ¨ |
| 12012 | ç³»ç»Ÿé”™è¯¯ |
| 12013 | è®¢å•å·ä¸ºç©º |
| 12014 | è®¢å•ä¸å­˜åœ¨ |

## é‡‘é¢å•ä½è¯´æ˜

- é‡‘é¢å•ä½ä¸º MBï¼ˆæœ€å°å•ä½ï¼‰
- `100` = 1 MB
- `10000` = 100 MB

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰æ¥å£éƒ½éœ€è¦ `app_id`ã€`sign` å’Œ `timestamp` è¿›è¡Œè®¤è¯ï¼ŒSDK ä¼šè‡ªåŠ¨æ·»åŠ 
2. å•†æˆ·è®¢å•å·ï¼ˆ`order_no`ï¼‰å¿…é¡»å”¯ä¸€ï¼Œé‡å¤çš„è®¢å•å·ä¼šè¿”å›é”™è¯¯
3. ä»˜æ¬¾é‡‘é¢å¿…é¡»å¤§äº 0
4. æ”¶æ¬¾åœ°å€å¿…é¡»æ˜¯æœ‰æ•ˆçš„ç”¨æˆ·åœ°å€

## è®¸å¯è¯

MIT License
